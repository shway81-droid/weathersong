<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>날씨 정보</title>
    <style>
      :root {
        color-scheme: light dark;
        --bg: #f5f7fa;
        --card-bg: #ffffff;
        --accent: #3a7bd5;
        --accent-dark: #2a5ea0;
        --text: #1f2933;
        --subtext: #52606d;
        --border: rgba(82, 96, 109, 0.15);
      }

      @media (prefers-color-scheme: dark) {
        :root {
          --bg: #111827;
          --card-bg: #1f2937;
          --accent: #60a5fa;
          --accent-dark: #3b82f6;
          --text: #f9fafb;
          --subtext: #d1d5db;
          --border: rgba(209, 213, 219, 0.15);
        }
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        font-family: "Segoe UI", Arial, sans-serif;
        background: var(--bg);
        color: var(--text);
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 24px;
      }

      main {
        width: min(480px, 100%);
        background: var(--card-bg);
        border-radius: 16px;
        box-shadow: 0 20px 40px rgba(17, 24, 39, 0.1);
        padding: 32px;
        border: 1px solid var(--border);
      }

      h1 {
        margin-top: 0;
        font-size: 1.8rem;
        text-align: center;
      }

      p.subtitle {
        margin: 8px 0 24px;
        text-align: center;
        color: var(--subtext);
      }

      form {
        display: flex;
        flex-direction: column;
        gap: 12px;
      }

      label {
        font-weight: 600;
      }

      input {
        padding: 12px 14px;
        border-radius: 10px;
        border: 1px solid var(--border);
        background: rgba(255, 255, 255, 0.9);
        color: inherit;
        font-size: 1rem;
      }

      input::placeholder {
        color: var(--subtext);
      }

      button {
        padding: 12px 14px;
        border-radius: 10px;
        border: none;
        background: var(--accent);
        color: #fff;
        font-weight: 600;
        font-size: 1rem;
        cursor: pointer;
        transition: background 150ms ease, transform 150ms ease;
      }

      button:hover {
        background: var(--accent-dark);
      }

      button:active {
        transform: translateY(1px);
      }

      .card {
        margin-top: 24px;
        border-radius: 12px;
        border: 1px solid var(--border);
        padding: 20px;
        background: rgba(58, 123, 213, 0.08);
      }

      .card h2 {
        margin: 0 0 16px;
        font-size: 1.4rem;
      }

      .grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
        gap: 12px;
      }

      .info {
        padding: 12px;
        border-radius: 10px;
        border: 1px solid var(--border);
        background: rgba(255, 255, 255, 0.7);
      }

      .info span {
        display: block;
        color: var(--subtext);
        font-size: 0.85rem;
        margin-bottom: 4px;
      }

      .info strong {
        font-size: 1.1rem;
      }

      .status {
        margin-top: 16px;
        text-align: center;
        color: var(--subtext);
      }

      .error {
        margin-top: 16px;
        padding: 12px;
        border-radius: 10px;
        color: #b91c1c;
        background: rgba(248, 113, 113, 0.12);
        border: 1px solid rgba(239, 68, 68, 0.4);
      }
    </style>
  </head>
  <body>
    <main>
      <h1>오늘의 날씨</h1>
      <p class="subtitle">
        원하는 지역 이름을 입력하면 실시간 날씨 정보를 확인할 수 있습니다.
      </p>
      <form id="weather-form">
        <label for="location">지역 이름</label>
        <input
          id="location"
          name="location"
          type="text"
          placeholder="예) Seoul, Busan, Tokyo"
          autocomplete="off"
          required
        />
        <button type="submit">날씨 조회</button>
      </form>
      <p id="status" class="status" hidden></p>
      <div id="error" class="error" hidden></div>
      <section id="result" class="card" hidden></section>
    </main>

    <script>
      const API_KEY = "f8e80208f3904eaf92d22850250911";
      const form = document.getElementById("weather-form");
      const statusEl = document.getElementById("status");
      const errorEl = document.getElementById("error");
      const resultEl = document.getElementById("result");
      const locationInput = document.getElementById("location");

      const sanitizeKey = (text) =>
        text
          .trim()
          .toLowerCase()
          .replace(/\s+/g, "")
          .replace(/(특별시|광역시|특별자치시|특별자치도|자치도|광역|특별|시|도)$/u, "");

      const koreanLocationMap = new Map(
        [
          ["서울", "Seoul"],
          ["부산", "Busan"],
          ["대구", "Daegu"],
          ["인천", "Incheon"],
          ["광주", "Gwangju"],
          ["대전", "Daejeon"],
          ["울산", "Ulsan"],
          ["세종", "Sejong"],
          ["수원", "Suwon"],
          ["춘천", "Chuncheon"],
          ["청주", "Cheongju"],
          ["천안", "Cheonan"],
          ["전주", "Jeonju"],
          ["목포", "Mokpo"],
          ["여수", "Yeosu"],
          ["포항", "Pohang"],
          ["창원", "Changwon"],
          ["제주", "Jeju"],
          ["광명", "Gwangmyeong"],
          ["김해", "Gimhae"],
          ["경기도", "Gyeonggi-do"],
          ["강원도", "Gangwon-do"],
          ["충청북도", "Chungcheongbuk-do"],
          ["충청남도", "Chungcheongnam-do"],
          ["전라북도", "Jeollabuk-do"],
          ["전라남도", "Jeollanam-do"],
          ["경상북도", "Gyeongsangbuk-do"],
          ["경상남도", "Gyeongsangnam-do"],
          ["제주도", "Jeju-do"],
        ].map(([ko, en]) => [sanitizeKey(ko), en])
      );

      const normalizeQuery = (input) => {
        const sanitized = sanitizeKey(input);
        return koreanLocationMap.get(sanitized) || input.trim();
      };

      const formatLocalTime = (localtime) => {
        if (!localtime) return "";
        const date = new Date(localtime.replace(" ", "T"));
        return new Intl.DateTimeFormat("ko-KR", {
          dateStyle: "medium",
          timeStyle: "short",
        }).format(date);
      };

      const showStatus = (message) => {
        statusEl.textContent = message;
        statusEl.hidden = false;
      };

      const hideStatus = () => {
        statusEl.hidden = true;
      };

      const showError = (message) => {
        errorEl.textContent = message;
        errorEl.hidden = false;
      };

      const hideError = () => {
        errorEl.hidden = true;
      };

      const renderWeather = (data) => {
        const {
          location: { name, region, country, localtime },
          current: {
            temp_c,
            temp_f,
            condition,
            feelslike_c,
            humidity,
            wind_kph,
            wind_dir,
            uv,
            pressure_mb,
          },
        } = data;

        resultEl.innerHTML = `
          <h2>${name}${region ? " · " + region : ""} (${country})</h2>
          <div class="grid">
            <div class="info">
              <span>현재 기온</span>
              <strong>${temp_c}°C (${temp_f}°F)</strong>
            </div>
            <div class="info">
              <span>체감 기온</span>
              <strong>${feelslike_c}°C</strong>
            </div>
            <div class="info">
              <span>날씨 상태</span>
              <strong>${condition.text}</strong>
            </div>
            <div class="info">
              <span>습도</span>
              <strong>${humidity}%</strong>
            </div>
            <div class="info">
              <span>풍속</span>
              <strong>${wind_kph} km/h (${wind_dir})</strong>
            </div>
            <div class="info">
              <span>기압</span>
              <strong>${pressure_mb} hPa</strong>
            </div>
            <div class="info">
              <span>자외선 지수</span>
              <strong>${uv}</strong>
            </div>
          </div>
          <p class="status">현지 시각: ${formatLocalTime(localtime)}</p>
        `;
        resultEl.hidden = false;
      };

      const searchLocation = async (query) => {
        const response = await fetch(
          `https://api.weatherapi.com/v1/search.json?key=${API_KEY}&q=${encodeURIComponent(
            query
          )}`
        );

        if (!response.ok) {
          const { error } = await response.json();
          throw new Error(error?.message || "지역을 찾을 수 없습니다.");
        }

        const candidates = await response.json();

        if (!Array.isArray(candidates) || candidates.length === 0) {
          throw new Error("해당 이름의 지역을 찾을 수 없습니다.");
        }

        const bestMatch = candidates[0];
        return {
          query: `${bestMatch.lat},${bestMatch.lon}`,
          label: `${bestMatch.name}${
            bestMatch.region ? " · " + bestMatch.region : ""
          } (${bestMatch.country})`,
        };
      };

      const fetchWeather = async (query) => {
        hideError();
        hideStatus();
        resultEl.hidden = true;
        showStatus("날씨 정보를 가져오는 중입니다...");

        try {
          const normalized = normalizeQuery(query);
          let locationQuery = normalized;

          try {
            const { query: resolvedQuery } = await searchLocation(normalized);
            locationQuery = resolvedQuery;
          } catch (searchErr) {
            console.warn("검색 API 사용 불가, 원본으로 조회 시도:", searchErr);
          }

          const response = await fetch(
            `https://api.weatherapi.com/v1/current.json?key=${API_KEY}&q=${encodeURIComponent(
              locationQuery
            )}&lang=ko`
          );

          if (!response.ok) {
            const { error } = await response.json();
            throw new Error(error?.message || "날씨 정보를 찾을 수 없습니다.");
          }

          const data = await response.json();
          hideStatus();
          renderWeather(data);
        } catch (err) {
          hideStatus();
          showError(err.message || "알 수 없는 오류가 발생했습니다.");
        }
      };

      form.addEventListener("submit", (event) => {
        event.preventDefault();
        const query = locationInput.value.trim();
        if (!query) {
          showError("지역 이름을 입력해주세요.");
          return;
        }
        fetchWeather(query);
      });

      window.addEventListener("DOMContentLoaded", () => {
        locationInput.focus();
      });
    </script>
  </body>
</html>

